#enable pacman color
sudo sed -i 's/#Color/Color/' /etc/pacman.conf

yes | sudo pacman -Syu
yes | sudo pacman -S --needed git vim zsh tmux
sudo ln -sf ./vim /usr/bin/vi

#clone dotfiles
if [[ ! -d ~/.dotfiles ]]; then
  git clone git://github.com/ZhengzhongZhang/dotfiles ~/.dotfiles
fi
ln -sf .dotfiles/vimrc ~/.vimrc
ln -sf .dotfiles/gitconfig ~/.gitconfig
curl https://raw.githubusercontent.com/tony/tmux-config/master/.tmux.conf > ~/.tmux.conf

#install Vundle and Plugins
if [[ ! -d ~/.vim/bundle/Vundle.vim/ ]]; then
  git clone git://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
  sed -i 's/colorscheme/"colorscheme/' ~/.vimrc
  vim < /dev/tty +PluginInstall +qall
  sed -i 's/"colorscheme/colorscheme/' ~/.vimrc
fi

#install prezto
if [[ ! -d ~/.zprezto ]]; then
  git clone --recursive git://github.com/ZhengzhongZhang/prezto.git "$HOME/.zprezto"
  # git clone git://github.com/sorin-ionescu/prezto.git "$HOME/.zprezto"
  # cd ~/.zprezto
  # git submodule update --init --recursive \
  #   modules/history-substring-search/external \
  #   modules/syntax-highlighting/external \
  #   modules/completion/external
  # cd ~
  # rm ~/.zprezto/modules/prompt/functions/{async,prompt_agnoster_setup,prompt_powerline_setup,prompt_pure_setup}

  zsh -c '
  setopt EXTENDED_GLOB
  for rcfile in "${ZDOTDIR:-$HOME}"/.zprezto/runcoms/^README.md(.N); do
    ln -s "$rcfile" "${ZDOTDIR:-$HOME}/.${rcfile:t}"
  done'

  sudo chsh -s /bin/zsh $USER
fi
